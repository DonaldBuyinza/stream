<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>MediaCapture and Streams API</title>
    <meta name="viewport" content="width=device-width">
    <link rel="stylesheet" href="main.css">
    <style>
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <header>
        <h1>MediaCapture, MediaRecorder and Streams API</h1>
    </header>
    <main>
        <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Impedit molestiae itaque facere totam saepe tempore esse temporibus, quae reprehenderit aliquid iusto ea laborum, iure eligendi odio exercitationem sapiente illum quos.</p>
        
        <p><button id="btnStart">START RECORDING</button><br/>
        <button id="btnStop" class="hidden">STOP RECORDING</button></p>
        
        <video id="video1" controls></video>
        
        <video id="vid2" class="hidden" width="201" height="180"></video>
        
        <!-- could save to canvas and do image manipulation and saving too -->
    </main>    
    <script>
        let constraintObj = { 
            audio: false, 
            video: { 
                facingMode: "user", 
                width: 201,
                height: 180
            } 
        }; 

        // Function to request camera access
        function requestCameraAccess() {
            navigator.mediaDevices.getUserMedia(constraintObj)
            .then(function(mediaStreamObj) {
                let video = document.getElementById('video1');
                if ("srcObject" in video) {
                    video.srcObject = mediaStreamObj;
                } else {
                    video.src = window.URL.createObjectURL(mediaStreamObj);
                }
                
                video.onloadedmetadata = function(ev) {
                    video.play();
                };
            })
            .catch(function(err) { 
                console.log(err.name, err.message); 
            });
        }

        // Start recording button event listener
        document.getElementById('btnStart').addEventListener('click', function() {
            requestCameraAccess();
            document.getElementById('btnStart').classList.add('hidden');
            document.getElementById('btnStop').classList.remove('hidden');
        });

        // Stop recording button event listener
        document.getElementById('btnStop').addEventListener('click', function() {
            let vidSave = document.getElementById('vid2');
            let video1 = document.getElementById('video1');
            vidSave.classList.remove('hidden');
            video1.classList.add('hidden');
            document.getElementById('btnStop').classList.add('hidden');
            document.getElementById('btnStart').classList.remove('hidden');
        });
    </script>
</body>
</html>
